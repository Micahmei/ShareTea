{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import axios from\"axios\";import{Line}from\"react-chartjs-2\";import{useNavigate}from\"react-router-dom\";import{Chart as ChartJS,CategoryScale,LinearScale,PointElement,LineElement,Title,Tooltip,Legend}from\"chart.js\";// 注册 Chart.js 组件\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";ChartJS.register(CategoryScale,LinearScale,PointElement,LineElement,Title,Tooltip,Legend);const Trends=()=>{const[salesData,setSalesData]=useState([]);const[dateLabels,setDateLabels]=useState([]);const[currentTrend,setCurrentTrend]=useState(\"Daily Sales\");const[timeRange,setTimeRange]=useState(\"Last 7 Days\");const navigate=useNavigate();useEffect(()=>{loadTrendData(currentTrend);},[currentTrend,timeRange]);const loadTrendData=async trendType=>{try{const response=await axios.get(\"http://localhost:5050/api/trends\",{params:{trendType,timeRange}});const trendData=response.data;setSalesData(trendData.map(item=>item.total_amount||item.order_count||item.used_quantity));setDateLabels(trendData.map(item=>item.date||item.usage_date));}catch(err){console.error(\"Error fetching trend data:\",err);alert(\"❌ Failed to fetch trend data.\");}};const chartData={labels:dateLabels,datasets:[{label:currentTrend,data:salesData,fill:false,borderColor:\"rgb(34 197 94)\",// 绿色\ntension:0.3}]};const chartOptions={responsive:true,scales:{x:{title:{display:true,text:\"Date\"}},y:{title:{display:true,text:\"Value\"}}}};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-50 p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-center text-green-700 mb-6\",children:\"\\uD83D\\uDCCA Trends Report\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col md:flex-row gap-6 justify-center items-center mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 text-center md:text-left\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold\",children:\"Select Trend Type\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-2\",children:[\"Daily Sales\",\"Peak Days\",\"Total Orders\",\"Product Usage\"].map(type=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>setCurrentTrend(type),className:`px-4 py-2 rounded border ${currentTrend===type?\"bg-green-600 text-white\":\"bg-white text-green-700 border-green-400\"} hover:bg-green-100`,children:type},type))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 text-center md:text-left\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold\",children:\"Select Time Range\"}),/*#__PURE__*/_jsxs(\"select\",{value:timeRange,onChange:e=>setTimeRange(e.target.value),className:\"border border-gray-300 rounded px-4 py-2\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"Last 7 Days\",children:\"Last 7 Days\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Last 30 Days\",children:\"Last 30 Days\"}),/*#__PURE__*/_jsx(\"option\",{value:\"All Time\",children:\"All Time\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white shadow-md p-4 rounded mb-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-2\",children:\"\\uD83D\\uDCC8 Data Chart\"}),/*#__PURE__*/_jsx(Line,{data:chartData,options:chartOptions})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white shadow-md p-4 rounded\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-2\",children:\"\\uD83D\\uDCCB Trend Data\"}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table-auto w-full border border-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"border px-4 py-2 text-left\",children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-4 py-2 text-left\",children:\"Value\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:dateLabels.length===0?/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"2\",className:\"text-center text-gray-500 py-4\",children:\"No trend data available\"})}):dateLabels.map((date,index)=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"border px-4 py-2\",children:date}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-4 py-2\",children:salesData[index]})]},index))})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center mt-6\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/manager\"),className:\"mt-4 px-6 py-2 bg-gray-500 text-white rounded hover:bg-gray-600\",children:\"\\u2B05\\uFE0F Back to Manager\"})})]});};export default Trends;","map":{"version":3,"names":["React","useState","useEffect","axios","Line","useNavigate","Chart","ChartJS","CategoryScale","LinearScale","PointElement","LineElement","Title","Tooltip","Legend","jsx","_jsx","jsxs","_jsxs","register","Trends","salesData","setSalesData","dateLabels","setDateLabels","currentTrend","setCurrentTrend","timeRange","setTimeRange","navigate","loadTrendData","trendType","response","get","params","trendData","data","map","item","total_amount","order_count","used_quantity","date","usage_date","err","console","error","alert","chartData","labels","datasets","label","fill","borderColor","tension","chartOptions","responsive","scales","x","title","display","text","y","className","children","type","onClick","value","onChange","e","target","options","length","colSpan","index"],"sources":["/Users/faqiangmei/Desktop/react-fix-test/frontend/src/components/Trends.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { Line } from \"react-chartjs-2\";\nimport { useNavigate } from \"react-router-dom\";\nimport {\n  Chart as ChartJS,\n  CategoryScale,\n  LinearScale,\n  PointElement,\n  LineElement,\n  Title,\n  Tooltip,\n  Legend,\n} from \"chart.js\";\n\n// 注册 Chart.js 组件\nChartJS.register(CategoryScale, LinearScale, PointElement, LineElement, Title, Tooltip, Legend);\n\nconst Trends = () => {\n  const [salesData, setSalesData] = useState([]);\n  const [dateLabels, setDateLabels] = useState([]);\n  const [currentTrend, setCurrentTrend] = useState(\"Daily Sales\");\n  const [timeRange, setTimeRange] = useState(\"Last 7 Days\");\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    loadTrendData(currentTrend);\n  }, [currentTrend, timeRange]);\n\n  const loadTrendData = async (trendType) => {\n    try {\n      const response = await axios.get(\"http://localhost:5050/api/trends\", {\n        params: {\n          trendType,\n          timeRange,\n        },\n      });\n      const trendData = response.data;\n      setSalesData(trendData.map((item) => item.total_amount || item.order_count || item.used_quantity));\n      setDateLabels(trendData.map((item) => item.date || item.usage_date));\n    } catch (err) {\n      console.error(\"Error fetching trend data:\", err);\n      alert(\"❌ Failed to fetch trend data.\");\n    }\n  };\n\n  const chartData = {\n    labels: dateLabels,\n    datasets: [\n      {\n        label: currentTrend,\n        data: salesData,\n        fill: false,\n        borderColor: \"rgb(34 197 94)\", // 绿色\n        tension: 0.3,\n      },\n    ],\n  };\n\n  const chartOptions = {\n    responsive: true,\n    scales: {\n      x: {\n        title: {\n          display: true,\n          text: \"Date\",\n        },\n      },\n      y: {\n        title: {\n          display: true,\n          text: \"Value\",\n        },\n      },\n    },\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-6\">\n      <h2 className=\"text-2xl font-bold text-center text-green-700 mb-6\">📊 Trends Report</h2>\n\n      <div className=\"flex flex-col md:flex-row gap-6 justify-center items-center mb-4\">\n        <div className=\"space-y-2 text-center md:text-left\">\n          <h3 className=\"font-semibold\">Select Trend Type</h3>\n          <div className=\"flex flex-wrap gap-2\">\n            {[\"Daily Sales\", \"Peak Days\", \"Total Orders\", \"Product Usage\"].map((type) => (\n              <button\n                key={type}\n                onClick={() => setCurrentTrend(type)}\n                className={`px-4 py-2 rounded border ${\n                  currentTrend === type\n                    ? \"bg-green-600 text-white\"\n                    : \"bg-white text-green-700 border-green-400\"\n                } hover:bg-green-100`}\n              >\n                {type}\n              </button>\n            ))}\n          </div>\n        </div>\n\n        <div className=\"space-y-2 text-center md:text-left\">\n          <h3 className=\"font-semibold\">Select Time Range</h3>\n          <select\n            value={timeRange}\n            onChange={(e) => setTimeRange(e.target.value)}\n            className=\"border border-gray-300 rounded px-4 py-2\"\n          >\n            <option value=\"Last 7 Days\">Last 7 Days</option>\n            <option value=\"Last 30 Days\">Last 30 Days</option>\n            <option value=\"All Time\">All Time</option>\n          </select>\n        </div>\n      </div>\n\n      <div className=\"bg-white shadow-md p-4 rounded mb-6\">\n        <h3 className=\"font-semibold mb-2\">📈 Data Chart</h3>\n        <Line data={chartData} options={chartOptions} />\n      </div>\n\n      <div className=\"bg-white shadow-md p-4 rounded\">\n        <h3 className=\"font-semibold mb-2\">📋 Trend Data</h3>\n        <div className=\"overflow-x-auto\">\n          <table className=\"table-auto w-full border border-gray-200\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"border px-4 py-2 text-left\">Date</th>\n                <th className=\"border px-4 py-2 text-left\">Value</th>\n              </tr>\n            </thead>\n            <tbody>\n              {dateLabels.length === 0 ? (\n                <tr>\n                  <td colSpan=\"2\" className=\"text-center text-gray-500 py-4\">\n                    No trend data available\n                  </td>\n                </tr>\n              ) : (\n                dateLabels.map((date, index) => (\n                  <tr key={index} className=\"hover:bg-gray-50\">\n                    <td className=\"border px-4 py-2\">{date}</td>\n                    <td className=\"border px-4 py-2\">{salesData[index]}</td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      <div className=\"text-center mt-6\">\n        <button\n          onClick={() => navigate(\"/manager\")}\n          className=\"mt-4 px-6 py-2 bg-gray-500 text-white rounded hover:bg-gray-600\"\n        >\n          ⬅️ Back to Manager\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default Trends;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}